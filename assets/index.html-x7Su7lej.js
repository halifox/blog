import{_ as i,c as a,a as n,o as l}from"./app-82cUmJ1Q.js";const t={};function e(h,s){return l(),a("div",null,[...s[0]||(s[0]=[n(`<h3 id="_1-标准用法" tabindex="-1"><a class="header-anchor" href="#_1-标准用法"><span>1. 标准用法</span></a></h3><p>在使用 <code>@hono/zod-validator</code> 时，标准的 JSON 校验写法如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-javascript"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> zValidator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> }</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> from</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">@hono/zod-validator</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">app</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">post</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">  &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  zValidator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">json</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> userSchema</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">),</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  (</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">c</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    // 只有校验通过后，才能通过 c.req.valid 获取数据</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    const</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> data</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> c</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">req</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">valid</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">json</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    return</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> c</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">json</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">({</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> success</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> data</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> })</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-踩坑实录" tabindex="-1"><a class="header-anchor" href="#_2-踩坑实录"><span>2. 踩坑实录</span></a></h3><p><strong>问题描述：</strong> 在一次开发中，发现接口始终返回校验失败（或 <code>data</code> 为空），但通过客户端日志观察，请求正文中确实包含了正确的 JSON 数据。</p><p><strong>排查结论：</strong> 经过分析定位，原因是请求头中缺失了 <strong><code>&#39;Content-Type&#39;: &#39;application/json&#39;</code></strong>。</p><p><strong>核心原理：</strong> Hono 的 <code>zValidator(&#39;json&#39;, ...)</code> 中间件会严格检查请求的 <code>Content-Type</code>。</p><ul><li>如果没有指定为 <code>application/json</code>，Hono 不会自动尝试解析请求正文。</li><li>结果导致中间件认为 Body 为空或格式非法，进而触发校验失败（Validation Failed）。</li></ul><h3 id="_3-经验总结" tabindex="-1"><a class="header-anchor" href="#_3-经验总结"><span>3. 经验总结</span></a></h3><ul><li><strong>强校验特性</strong>：<code>zValidator</code> 的第一个参数（如 <code>&#39;json&#39;</code> 或 <code>&#39;form&#39;</code>）不仅决定了如何校验，也决定了它去哪里找数据。</li><li><strong>客户端要求</strong>：使用 <code>json</code> 模式时，必须确保请求头包含 <code>Content-Type: application/json</code>。</li><li><strong>排查思路</strong>：当遇到“明明发了数据却校验不通过”时，<strong>首要检查请求头</strong>而非数据逻辑。</li></ul>`,10)])])}const p=i(t,[["render",e]]),d=JSON.parse('{"path":"/blog/0o1gbcez/","title":"故障笔记：为什么 Hono zValidator 拿不到请求数据？","lang":"zh-CN","frontmatter":{"title":"故障笔记：为什么 Hono zValidator 拿不到请求数据？","createTime":"2026/01/16 14:50:49","permalink":"/blog/0o1gbcez/"},"readingTime":{"minutes":1.14,"words":342},"git":{"createdTime":1768546661000,"updatedTime":1768547117000,"contributors":[{"name":"halifox","username":"halifox","email":"106858061+halifox@users.noreply.github.com","commits":2,"avatar":"https://avatars.githubusercontent.com/halifox?v=4","url":"https://github.com/halifox"}]},"filePathRelative":"blog/为什么 Hono zValidator 拿不到请求数据.md","headers":[],"categoryList":[]}');export{p as comp,d as data};
