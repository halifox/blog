import{_ as i,c as e,a,o as t}from"./app-82cUmJ1Q.js";const n={};function l(h,s){return t(),e("div",null,[...s[0]||(s[0]=[a(`<h2 id="情景" tabindex="-1"><a class="header-anchor" href="#情景"><span>情景</span></a></h2><p>在 Windows 使用 <strong>WSL2 + Docker</strong> 时，有时会遇到容器无法绑定 <strong>1883 端口</strong>（例如 MQTT 服务端口）的问题。 奇怪的是，使用以下命令检查后发现该端口并没有被占用：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">netstat</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -ano</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> findstr</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1883</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>或在 Linux 子系统中：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lsof</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -i:1883</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>结果均为空，说明 1883 端口并未被进程占用。 即使重启 Docker、WSL 或整台电脑，问题依旧存在。</p><hr><h3 id="原因分析" tabindex="-1"><a class="header-anchor" href="#原因分析"><span>原因分析</span></a></h3><p>通过查询资料发现，问题不是端口被程序占用，而是 <strong>Windows 系统自动保留了部分端口范围（Excluded Port Range）</strong>。 这些被保留的端口无法被 Docker 映射使用，即便看似空闲。</p><hr><h3 id="解决方法" tabindex="-1"><a class="header-anchor" href="#解决方法"><span>解决方法</span></a></h3><ol><li><p>停止并重新启动 NAT 服务：</p><div class="language-cmd line-numbers-mode" data-highlighter="shiki" data-ext="cmd" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-cmd"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">net stop winnat</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">net start winnat</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>查看被系统保留的端口范围：</p><div class="language-cmd line-numbers-mode" data-highlighter="shiki" data-ext="cmd" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-cmd"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">netsh interface ipv4 show excludedportrange </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">protocol</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">tcp</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>检查输出中是否包含 <code>1883</code>。</p></li><li><p>若被保留，可临时释放；重启后如果再次被占用，可考虑调整系统的动态端口范围或避免使用该端口。</p></li></ol><hr><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><p>当在 WSL2 + Docker 环境中出现 <strong>端口明明空闲但无法绑定</strong> 的情况，尤其是常用服务端口（如 1883、3306、8080 等）， 优先检查 <strong>系统保留端口列表</strong>，并通过重启 <code>winnat</code> 服务刷新端口分配即可解决。</p>`,15)])])}const d=i(n,[["render",l]]),c=JSON.parse('{"path":"/blog/2bsm802m/","title":"故障笔记：WSL2 Docker 端口空闲但无法绑定","lang":"zh-CN","frontmatter":{"title":"故障笔记：WSL2 Docker 端口空闲但无法绑定","createTime":"2025/10/02 00:00:00","permalink":"/blog/2bsm802m/","tags":["wsl","docker"]},"readingTime":{"minutes":1.21,"words":362},"git":{"createdTime":1762260792000,"updatedTime":1768547117000,"contributors":[{"name":"halifox","username":"halifox","email":"106858061+halifox@users.noreply.github.com","commits":6,"avatar":"https://avatars.githubusercontent.com/halifox?v=4","url":"https://github.com/halifox"}]},"filePathRelative":"blog/WSL2 Docker 端口空闲但无法绑定.md","headers":[],"categoryList":[]}');export{d as comp,c as data};
